  SELECT
  PR.CD_PRESTADOR, PR.NM_PRESTADOR,  PA.NM_PACIENTE, ATE.CD_SERVICO, SERV.DS_SERVICO SERVICO, ATE.CD_ESPECIALID, ESP.DS_ESPECIALID ESPECIALIDADE
, ATE.CD_ATENDIMENTO ATENDIMENTO, ATE.CD_PACIENTE AS PRONTUARIO, ATE.DT_ATENDIMENTO, 
CASE
 WHEN ((TO_CHAR(ATE.DT_ALTA,'MM') <= TO_CHAR(ATE.DT_ATENDIMENTO,'MM'))) THEN ATE.DT_ALTA ELSE NULL END DT_ALTA,

CASE 
  WHEN 
  TO_NUMBER(TO_DATE(CASE 
      WHEN ((TO_CHAR(ATE.DT_ALTA,'MM') <= TO_CHAR(ATE.DT_ATENDIMENTO,'MM'))) THEN ATE.DT_ALTA 
      ELSE TO_DATE (TO_CHAR(LAST_DAY(ATE.DT_ATENDIMENTO) ,'DD')||'/'||TO_CHAR(ATE.DT_ATENDIMENTO, 'MM/RRRR'),'DD/MM/RRRR')
  END,'DD/MM/RRRR HH24:MI') - TO_DATE(ATE.DT_ATENDIMENTO ,'DD/MM/RRRR HH24:MI')) = 0 THEN 1
  ELSE TO_NUMBER(TO_DATE(CASE 
      WHEN ((TO_CHAR(ATE.DT_ALTA,'MM') <= TO_CHAR(ATE.DT_ATENDIMENTO,'MM'))) THEN ATE.DT_ALTA 
      ELSE TO_DATE (TO_CHAR(LAST_DAY(ATE.DT_ATENDIMENTO) ,'DD')||TO_CHAR(ATE.DT_ATENDIMENTO, 'MM/RRRR'),'DD/MM/RRRR')
  END,'DD/MM/RRRR HH24:MI') - TO_DATE(ATE.DT_ATENDIMENTO ,'DD/MM/RRRR HH24:MI'))
END DIARIA

, ATE.CD_CID, (SELECT DS_CID FROM CID WHERE ATE.CD_CID = CD_CID) DESCRICAO_CID, PA.DT_NASCIMENTO, FN_IDADE(PA.DT_NASCIMENTO,'a') AS IDADE
, PA.NR_IDENTIDADE, (SELECT NM_CONVENIO FROM CONVENIO WHERE CD_CONVENIO = ATE.CD_CONVENIO) AS CONVENIO, 
(SELECT DS_CON_PLA FROM CON_PLA WHERE CD_CON_PLA = ATE.CD_CON_PLA AND CD_CONVENIO = ATE.CD_CONVENIO) AS PLANO, 
PR.CD_PRESTADOR_MUITOS, ATE.TP_ATENDIMENTO, PR.CD_PRESTADOR_REPASSE,  
(SELECT PRE.NM_PRESTADOR FROM DBAMV.PRESTADOR PRE WHERE PRE.CD_PRESTADOR = PR.CD_PRESTADOR_MUITOS ) AS NM_PRESTADOR_MUITOS, ATE.SN_RETORNO

, TO_CHAR(TO_CHAR(ATE.DT_ATENDIMENTO, 'MM/RRRR')) MES_ANO

FROM ATENDIME ATE 
  INNER JOIN PACIENTE PA ON (ATE.CD_PACIENTE = PA.CD_PACIENTE)
  INNER JOIN PRESTADOR PR ON (ATE.CD_PRESTADOR = PR.CD_PRESTADOR)
  INNER JOIN DBAMV.SERVICO SERV ON ATE.CD_SERVICO =SERV.CD_SERVICO
  INNER JOIN DBAMV.ESPECIALID ESP ON ATE.CD_ESPECIALID=ESP.CD_ESPECIALID

WHERE ATE.CD_ATENDIMENTO NOT IN (1,19)
