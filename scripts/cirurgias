SELECT * FROM (
SELECT AVISO_CIRURGIA.CD_AVISO_CIRURGIA CD_AVISO_CIRURGIA,
              AVISO_CIRURGIA.CD_ATENDIMENTO CD_ATENDIMENTO,
              AVISO_CIRURGIA.CD_PACIENTE CD_PACIENTE,
              AVISO_CIRURGIA.NM_PACIENTE NM_PACIENTE,
             TRUNC(AVISO_CIRURGIA.DT_REALIZACAO)           DT_REALIZACAO,
             PRESTADOR_AVISO.CD_PRESTADOR CD_PRESTADOR,
             NVL(PRESTADOR.NM_PRESTADOR, 'NAO INFORMADO') NM_PRESTADOR,
             PRESTADOR.DS_CODIGO_CONSELHO CRM,
             CIRURGIA.CD_CIRURGIA CD_CIRURGIA,
             CIRURGIA.DS_CIRURGIA DS_CIRURGIA,
             CEN_CIR.CD_CEN_CIR CD_CEN_CIR,
             CEN_CIR.DS_CEN_CIR DS_CEN_CIR,
             PRESTADOR_AVISO.DS_ATI_MED DS_ATI_MED,
             DECODE(CONVENIO.TP_CONVENIO,
                               'A', CIRURGIA.CD_PROCEDIMENTO_SIA,
                               'H', CIRURGIA.CD_PROCEDIMENTO_SIH,
                               CIRURGIA.CD_PRO_FAT)          CD_PROCEDIMENTO,
             CONVENIO.NM_CONVENIO NM_CONVENIO,
             CIRURGIA_AVISO.TP_NATUREZA TP_NATUREZA
  FROM DBAMV.AVISO_CIRURGIA,
             DBAMV.CIRURGIA_AVISO,
             DBAMV.CIRURGIA,
             DBAMV.CEN_CIR,
             DBAMV.CONVENIO,
             DBAMV.PRESTADOR,
             (SELECT P_A.CD_PRESTADOR,
                             A_M.DS_ATI_MED,
                             P_A.CD_CIRURGIA_AVISO,
                             P_A.CD_AVISO_CIRURGIA
              FROM  DBAMV.PRESTADOR_AVISO P_A,
              DBAMV.ATI_MED A_M
              WHERE A_M.CD_ATI_MED = P_A.CD_ATI_MED
              and P_A.sn_principal = 'S'
             -- AND A_M.TP_FUNCAO = 'C'    -- OP47914 - JASF
             ) PRESTADOR_AVISO
,Dbamv.Empresa_Convenio
Where Empresa_Convenio.Cd_Convenio = Convenio.Cd_Convenio
And Empresa_Convenio.Cd_Multi_Empresa = 1
And AVISO_CIRURGIA.TP_SITUACAO  =  'R'
      AND  AVISO_CIRURGIA.DT_REALIZACAO BETWEEN To_Date('01/08/2018','dd/mm/yyyy') and  To_Date('31/08/2018','dd/mm/yyyy')
      AND  AVISO_CIRURGIA.CD_CEN_CIR  =  CEN_CIR.CD_CEN_CIR
      AND  AVISO_CIRURGIA.CD_AVISO_CIRURGIA  =  CIRURGIA_AVISO.CD_AVISO_CIRURGIA
      AND  CIRURGIA_AVISO.CD_CIRURGIA   =  CIRURGIA.CD_CIRURGIA
      AND  CIRURGIA_AVISO.CD_CONVENIO  =  CONVENIO.CD_CONVENIO (+)
      AND  CIRURGIA_AVISO.CD_AVISO_CIRURGIA = PRESTADOR_AVISO.CD_AVISO_CIRURGIA (+)
      AND  CIRURGIA_AVISO.CD_CIRURGIA_AVISO  =  PRESTADOR_AVISO.CD_CIRURGIA_AVISO (+)
      AND  PRESTADOR_AVISO.CD_PRESTADOR     =  PRESTADOR.CD_PRESTADOR (+)

ORDER BY  CD_PRESTADOR,
                     DT_REALIZACAO

)
ORDER BY CD_CEN_CIR,DS_CEN_CIR,
NM_PRESTADOR,CD_PRESTADOR,CRM,
DT_REALIZACAO,
CD_PACIENTE,NM_PACIENTE,NM_CONVENIO,CD_ATENDIMENTO,CD_AVISO_CIRURGIA
